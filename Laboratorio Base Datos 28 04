#include <iostream>
#include <conio.h>
#include <string.h>
#include <stdio.h>

using namespace std;

struct regAmigo{
	char nombre[30];
	char sexo; //F de Femenino y M de Masculino
	int edad;
	char estado; //A de Activo y E de Eliminado
};

void crearArchivo(char nombArch[]);
void adicionarAmigo();
void listarAmigo();


void main(){
	int opcion;
	do{
		cout << "==================================================================================================" << endl;
		cout << " \t\t ***Menu de Programa de archivo*** " << endl;
		cout << " \t1.- Crear Archivo nuevo. " << endl;
		cout << " \t2.- Adicionar Usuarios al Archivo(Base de Datos). " << endl;
		cout << " \t3.- Mostrar los Usuarios ingresados en la Base de Datos. " << endl;
		cout << " \t0.- Salir. " << endl;
		cout << " \tSeleccione una opcion: ";
		cin >> opcion;
		switch( opcion ){
			case 1:	crearArchivo("amigos.dat");
					break;
			case 2:	adicionarAmigo();
					break;
			case 3: listarAmigo();
					break;
		}
	}while(opcion !=0);
	getch();
}

void crearArchivo(char nombArch[]){
	FILE *ptr;
	ptr = fopen(nombArch,"wb");
	fclose(ptr);
}

void adicionarAmigo(){
	FILE *ptr;
	regAmigo reg;
	ptr = fopen("amigos.dat","wb");
	cout << "Introducir el nombre del amigo(a) : ";
	do{
		gets(reg.nombre);
	}while(strlen(reg.nombre) == 0);
	do{
		cout << "Sexo < F // M > ? : ";
		cin >> reg.sexo;
		if(reg.sexo != 'F' || reg.sexo != 'M'){
			cout << "Opcion invalida ingrese una de las opciones validas!!!" << endl;
		}
	}while (reg.sexo != 'F' && reg.sexo != 'M'); //valida entrada para Sexo.
	do{
		cout << "Edad ? : ";
		cin >> reg.edad;
		if(reg.edad < 1 || reg.edad > 100){
			cout << "\nError....!!! Debe introducir un valor entre 1 y 100.\n";
		}
	}while(reg.edad < 1 || reg.edad > 100); // valida entrada de edad en un rango de 1 a 100
	reg.estado = 'A';
	fwrite(&reg,sizeof(reg),1,ptr); //escribe registro en archivo 
	fclose(ptr);
}
void listarAmigo(){
	FILE *ptr;
	regAmigo reg;
	ptr = fopen("amigos.dat","rb");
	if(ptr != NULL){
		fread(&reg,sizeof(reg),1,ptr); //lee registro desde el archivo
		while(feof(ptr) == false){
			if(reg.estado = 'A'){ // verifica si el registro esta activo
				cout << endl << reg.nombre << "\t" << reg.edad <<"\t" << reg.sexo;
			}
			fread(&reg,sizeof(reg),1,ptr); // lee registro desde el archivo
		}
		fclose(ptr);
	}else{
		cout << "\nError...!!!, archivo no existe..\n";
	}
}
